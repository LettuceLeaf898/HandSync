<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Play Hand-Sync!</title>
    <link href="https://fonts.googleapis.com/css?family=Julius+Sans+One&display=swap" rel="stylesheet" />
    <style>
        * {
  box-sizing: border-box;
}
body {
  font-size: 14px;
}
.v1_3 {
  width: 100%;
  height: 720px;
  background: rgba(255,255,255,1);
  opacity: 1;
  position: relative;
  top: 0px;
  left: 0px;
  overflow: hidden;
}
.v1_5 {
  width: 484px;
  color: rgba(39,76,119,1);
  position: absolute;
  top: 36px;
  left: 398px;
  text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
  font-family: Julius Sans One;
  font-weight: Regular;
  font-size: 80px;
  opacity: 1;
  text-align: left;
}
.v15_5 {
  width: 421px;
  height: 512px;
  background: rgba(39,76,119,1);
  opacity: 1;
  position: absolute;
  top: 152px;
  left: 784px;
  border: 9px solid rgba(39,76,119,1);
  overflow: hidden;
}
.v15_7 {
  width: 421px;
  height: 512px;
  background: rgba(255,255,255,1);
  opacity: 1;
  position: absolute;
  top: 152px;
  left: 80px;
  border: 9px solid rgba(39,76,119,1);
  overflow: hidden;
}
.v15_9 {
  width: 421px;
  height: 78px;
  background: rgba(231,236,239,1);
  opacity: 1;
  position: absolute;
  top: 153px;
  left: 80px;
  border: 9px solid rgba(39,76,119,1);
  overflow: hidden;
}
.v15_13 {
  width: 421px;
  height: 78px;
  background: rgba(231,236,239,1);
  opacity: 1;
  position: absolute;
  top: 153px;
  left: 784px;
  border: 9px solid rgba(39,76,119,1);
  overflow: hidden;
}
.v15_15 {
  width: 277px;
  color: rgba(39,76,119,1);
  position: absolute;
  top: 166px;
  left: 152px;
  font-family: Julius Sans One;
  font-weight: Regular;
  font-size: 60px;
  opacity: 1;
  text-align: left;
}
.v15_16 {
  width: 195px;
  color: rgba(39,76,119,1);
  position: absolute;
  top: 166px;
  left: 895px;
  font-family: Julius Sans One;
  font-weight: Regular;
  font-size: 60px;
  opacity: 1;
  text-align: left;
}
.name {
  color: #fff;
}
.name {
  color: #fff;
}
.button{
  position: absolute;
  top: 20px;
  left: 20px;
  display: inline-block;        
  text-decoration: none;          
  text-align: center;           
  background-color: #E7ECEF;
  border: 2px solid #274C77;  
  color: #274C77;
  font-family:Arial, Helvetica, sans-serif;
  font-size: 20px;
  cursor: pointer;
  width: 70px;             
}

/* Stream styling */
.stream-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.stream-controls button.button {
  width: 90px;
  left: auto; /* override .button left */
}

    </style>
</head>
<body>
    <div class="v1_3">
       <a href="index.html" class="button">Back</a>
        <span class="v1_5">Hand-Sync</span>

        <div class="v15_5">
          <!-- Embedded MJPEG stream -->
          <img id="video-stream" class="stream-img" src="{{ url_for('video_feed') }}" alt="Live Stream">
        </div>
        <div class="v15_7"></div>
        <div class="v15_9"></div>
        <div class="v15_13"></div>

        <span class="v15_15">Beat Map</span>
        <span class="v15_16">Player
          <!-- <h1>Live Video Stream</h1>
          <img src="{{ url_for('video_feed') }}" width="640" height="480"> -->
        </span>

        <div class="name"></div>
        <div class="name"></div>
    </div>

    <script>
      (function(){
        const streamUrl = "{{ url_for('video_feed') }}";
        const img = document.getElementById('video-stream');
        const toggle = document.getElementById('toggle-stream');
        const snapshotBtn = document.getElementById('snapshot');

        // Retry logic when stream errors
        if (img) {
          img.onerror = () => {
            console.warn('Stream error, retrying in 1s');
            setTimeout(() => {
              if (img.src === '') return; // paused
              img.src = streamUrl + '?t=' + Date.now();
            }, 1000);
          };
        }

        // Pause / resume stream
        if (toggle && img) {
          toggle.addEventListener('click', () => {
            if (img.src && img.src.length > 0) {
              img.dataset._prev = img.src;
              img.src = '';
              toggle.textContent = 'Resume';
            } else {
              img.src = streamUrl + '?t=' + Date.now();
              toggle.textContent = 'Pause';
            }
          });
        }

        // Snapshot current frame
        if (snapshotBtn && img) {
          snapshotBtn.addEventListener('click', () => {
            const w = window.open('', '_blank');
            try {
              const canvas = document.createElement('canvas');
              canvas.width = img.naturalWidth || 640;
              canvas.height = img.naturalHeight || 480;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
              const data = canvas.toDataURL('image/png');
              w.document.write('<img src="' + data + '" alt="snapshot">');
            } catch (e) {
              w.document.write('<p>Snapshot failed: ' + e + '</p>');
            }
          });
        }
      })();
    </script>

</body>
</html>
